# db/database.py
import os
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from .models import Base

DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./test.db")

# Nếu dùng sqlite, thêm connect_args
engine = create_engine(
    DATABASE_URL,
    connect_args={"check_same_thread": False} if "sqlite" in DATABASE_URL else {}
)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def init_db():
    Base.metadata.create_all(bind=engine)

def seed_db():
    """Hàm này thêm dữ liệu giả để test nếu bảng crawled_data còn trống."""
    from db.models import CrawledData
    session = SessionLocal()
    # Nếu chưa có dữ liệu, thêm vài record giả
    if not session.query(CrawledData).first():
        fake_articles = [
            CrawledData(
                url="https://vnexpress.net/visana-la-dai-ly-uy-thac-cua-dai-su-quan-han-quoc-tai-ha-noi-4810469.html",
                contents="""
                Visana - đơn vị dịch vụ tư vấn visa (trực thuộc Vietnam Discovery Travel) trở thành đại diện nộp thị thực của Đại sứ quán Hàn Quốc tại Hà Nội, từ ngày 18/10. Để trở thành đại lý ủy thác của Đại sứ quán Hàn Quốc, Visana phải trải qua quy trình tuyển chọn công khai với các tiêu chí nghiêm ngặt. Theo đó, đối tác của Đại sứ quán phải đảm bảo chuyên môn và kinh nghiệm xử lý hồ sơ, tỷ lệ sai sót thấp và tỷ lệ visa thành công cao. Đội ngũ tư vấn viên, thẩm định hồ sơ thị thực khách hàng của Visana. Ảnh: Visana Đội ngũ tư vấn viên, thẩm định hồ sơ thị thực khách hàng của Visana. Ảnh: Visana Bên cạnh đó, đơn vị ủy thác cần cam kết tuân thủ tiêu chuẩn đạo đức cao nhất, bảo mật và minh bạch trong việc xử lý hồ sơ; xây dựng và vận hành quy trình chăm sóc khách hàng chuyên nghiệp. Tất cả các yếu tố trên giúp Visana thu hút hơn 1 triệu lượt quan tâm đến dịch vụ visa Hàn Quốc mỗi năm trên website. Visana được ủy thác hỗ trợ khách hàng nộp tất cả thị thực của Hàn Quốc, trừ thị thực kết hôn. Theo đại diện công ty, bên cạnh dịch vụ visa trọn gói, Visana là một trong những công ty đầu tiên cung cấp đa dạng dịch vụ riêng lẻ như hợp pháp hóa lãnh sự, giấy phép lao động, bảo hiểm du lịch, visa hội chợ, gia hạn visa... Mỗi bộ hồ sơ tại Visana đều được thẩm định, khai thác thông tin chuyên sâu theo từng trường hợp khách hàng để đảm bảo đạt tỷ lệ đậu cao nhất. Tỷ lệ đậu visa của khách hàng Visana đạt tới 98,6%, theo ông Nguyễn Quang Chuẩn, Phó Giám đốc Visana. Việc trở thành đơn vị đại diện nộp thị thực của Đại sứ quán Hàn Quốc khẳng định chất lượng dịch vụ của Visana. Đây là một phần trong tầm nhìn dài hạn của đội ngũ lãnh đạo Visana, mang lại nhiều lợi ích thiết thực cho khách hàng. Trước đó, năm 2023, Visana cũng được Đại sứ quán Trung Quốc tin tưởng chọn làm đơn vị uỷ thác. Với vai trò mới này, đương đơn khi nộp hồ sơ xin thị thực Hàn Quốc qua Visana sẽ được rút ngắn thời gian thẩm tra từ 16 ngày còn 9 ngày làm việc, miễn sổ tiết kiệm và xác nhận số dư sổ tiết kiệm, tiếp cận thông tin nhanh chóng từ Đại sứ quán Hàn Quốc, nhận hỗ trợ chuyên nghiệp khi có vấn đề phát sinh. Visana không chỉ là cầu nối giữa đương đơn với Đại sứ quán, còn là đơn vị bảo lãnh và chịu trách nhiệm với từng bộ hồ sơ. Đây là cơ hội để Visana khẳng định vai trò trong việc đưa người Việt đến xứ sở kim chi và khắp thế giới, mở ra cánh cửa hợp tác và giao lưu văn hóa kinh tế.
                """,
                analysis=None,
                is_analyzed=False
            ),
            CrawledData(
                url="https://vtv.vn/doi-song/lam-dich-vu-visa-khong-co-nghia-la-bao-dau-100-20250114201050295.htm",
                contents="""
                VTV.vn - Với tư cách là đơn vị hàng đầu cung cấp giải pháp visa, VISANA - Top 20 thương hiệu xuất sắc 2024 luôn mong muốn khách hàng hiểu đúng về vai trò của dịch vụ tư vấn. Hiểu đúng vai trò của đơn vị dịch vụ tư vấn visa Trong thời đại toàn cầu hóa, nhu cầu xuất nhập cảnh, di chuyển quốc tế ngày càng tăng. Đó là tín hiệu đáng mừng cho ngành dịch vụ tư vấn visa, nhưng đồng thời cũng là thách thức khi có không ít quốc gia thắt chặt chính sách xét duyệt cấp visa hơn trước để đảm bảo an ninh và phát triển của đất nước họ. Làm dịch vụ visa không có nghĩa là bao đậu 100% - Ảnh 1. Không phải ai cũng hiểu đúng vai trò của đơn vị dịch vụ tư vấn visa Theo đó, khách hàng tìm đến đơn vị tư vấn visa ngày càng nhiều, nhưng không phải ai cũng hiểu đúng vai trò và trách nhiệm của đơn vị dịch vụ. Vậy, các đơn vị dịch vụ tư vấn visa có thể giúp gì cho người có nhu cầu xin visa? Thay vì phải tự tìm hiểu và hoàn thiện từng thủ tục, khách hàng có thể ủy thác toàn bộ quá trình chuẩn bị hồ sơ, nộp đơn xin visa cho đơn vị dịch vụ với sự tư vấn kỹ lưỡng. Bằng kinh nghiệm và kiến thức chuyên môn, các chuyên viên tư vấn sẽ thiết kế cho bạn giải pháp visa phù hợp với năng lực hồ sơ, hướng dẫn và đồng hành cùng bạn chuẩn bị bộ hồ sơ xin visa hoàn hảo và an toàn nhất giúp tăng khả năng được cấp visa lên mức tối đa. Bên cạnh đó, đối với các quốc gia yêu cầu phỏng vấn khi xin visa, bạn sẽ được chia sẻ kiến thức, kinh nghiệm khi lên Đại sứ quán, luyện phỏng vấn 1:1 với chuyên gia để giúp bạn chuẩn bị kỹ càng các câu trả lời, nâng cao sự tự tin để tăng khả năng thuyết phục Đại sứ quán. Ngoài ra, đơn vị tư vấn visa sẽ giúp bạn tránh những sai sót không đáng có trong hồ sơ, giúp bạn tiết kiệm thời gian và công sức. Mặc dù phải trả phí dịch vụ, nhưng việc sử dụng dịch vụ tư vấn visa có thể giúp bạn tiết kiệm chi phí hơn trong trường hợp bị từ chối và phải làm lại do những sai sót không đáng có. Để đảm bảo quyền lợi của mình, bạn nên tìm hiểu kỹ càng về quá trình, thủ tục xin visa, hoặc lựa chọn những đơn vị dịch vụ tư vấn visa uy tín, có nhiều năm kinh nghiệm và được nhiều khách hàng đánh giá cao. Có hay không việc "bao đậu visa"? Đây là một điều quan trọng mà bất cứ công dân nào cũng cần biết trước khi sử dụng dịch vụ visa. VISANA khẳng định rằng không có đơn vị dịch vụ visa nào có thể đảm bảo 100% rằng bạn sẽ được cấp visa. Bởi quyết định cuối cùng có cấp visa hay không phụ thuộc hoàn toàn vào cơ quan Lãnh sự. Làm dịch vụ visa không có nghĩa là bao đậu 100% - Ảnh 2. Đơn vị dịch vụ có thể bao đậu 100% không? Đơn vị dịch vụ visa đóng vai trò kết nối đương đơn xin visa với Đại sứ quán, Lãnh sự quán; với nhiệm vụ sàng lọc hồ sơ, thẩm định đầu vào, giúp đơn đơn chuẩn bị hồ sơ chất lượng cao nhất để thuyết phục Đại sứ quán cấp visa cho họ. Vậy nên, việc đơn vị dịch vụ visa bao đậu cho khách hàng là không thể có. Cho dù bạn cung cấp đầy đủ hồ sơ theo danh mục yêu cầu, nhân viên Lãnh sự sẽ còn xem xét và đánh giá tính xác thực của hồ sơ thông qua các bằng chứng đi kèm. Trong một số trường hợp cần thiết, Lãnh sự quán có thể sẽ liên hệ với Công ty nơi bạn ký hợp đồng làm việc, Ngân hàng nơi thể hiện bạn nhận lương hoặc có tiền gửi tiết kiệm, người thân/người đi cùng trong chuyến đi của bạn để xác thực thông tin thật chính xác trước khi ra quyết định có cấp visa cho bạn hay không. VISANA - 17+ năm kiên trì với triết lý bền vững, lọt TOP 20 thương hiệu xuất sắc năm 2024 2024 là một năm đầy thành công với VISANA khi được phục vụ hàng ngàn khách hàng, và liên tục ghi thêm những thành tựu mới lên hành trình 17+ năm cung cấp giải pháp visa. Và trước thềm năm mới, VISANA đã vinh dự được xướng tên trong TOP 20 Thương hiệu xuất sắc hàng đầu Việt Nam năm 2024 tại sự kiện "Hàng Việt tốt" lần thứ 21, do Viện Kinh tế & Văn hóa phối hợp với Trung tâm Bảo vệ Người tiêu dùng tổ chức. Làm dịch vụ visa không có nghĩa là bao đậu 100% - Ảnh 3. VISANA tại lễ trao bảng vàng Thương hiệu xuất sắc hàng đầu Việt Nam năm 2024 Đó không chỉ là niềm tin, sự yêu quý của khách hàng dành tặng, mà còn là minh chứng cho chất lượng dịch vụ của VISANA. 17+ năm theo đuổi triết lý bền vững, VISANA luôn đặt lợi ích lâu dài của khách hàng lên hàng đầu: Thứ nhất, thiết kế giải pháp visa khả thi và cá nhân hóa: không thiết kế giải pháp đại trà, VISANA thẩm định chuyên sâu từng bộ hồ sơ của khách hàng, thiết kế giải pháp visa riêng biệt cho mỗi cá nhân, phù hợp với năng lực của từng đương đơn để mỗi bộ hồ sơ nộp lên Đại sứ quán là hoàn hảo và an toàn nhất, giúp tăng khả năng đậu visa lên mức tối đa. Thứ hai, xây dựng hồ sơ minh bạch, bền vững và an toàn: VISANA tôn trọng mọi thông tin và trải nghiệm của khách hàng, cam kết công khai, minh bạch xuyên suốt quá trình cung cấp dịch vụ, bao gồm: tư vấn, hỗ trợ khai báo thông tin chính xác, trung thực dưới sự đồng thuận của khách hàng; bàn giao cho khách hàng toàn bộ thông tin đã cung cấp cho cơ quan Lãnh sự, khuyến khích khách hàng chú trọng việc đồng nhất thông tin trong các lần xin visa tiếp theo. VISANA hướng đến việc xây dựng tính bền vững cho hồ sơ xin visa của khách hàng, dù trong trường hợp rủi ro nhất sẽ không ảnh hưởng đến lần nộp đơn tiếp theo. Cuối cùng, cam kết bảo mật tối đa: Tất cả thông tin cá nhân của khách hàng đều được bảo mật tuyệt đối, tránh rủi ro lừa đảo, lộ thông tin,... mang đến sự an tâm tuyệt đối cho khách hàng. Việc được vinh danh trong TOP 20 Thương hiệu Xuất Sắc là một minh chứng rõ ràng cho những nỗ lực không ngừng nghỉ của VISANA. Đồng thời, đây cũng là sự tri ân lớn nhất cho những tin tưởng, ủng hộ của khách hàng và đối tác. Trong tương lai, VISANA sẽ tiếp tục phấn đấu để trở thành một trong những thương hiệu hàng đầu trong lĩnh vực du lịch và dịch vụ tư vấn visa tại Việt Nam.
                """,
                analysis=None,
                is_analyzed=False
            ),
        ]
        session.add_all(fake_articles)
        session.commit()
    session.close()
